<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Price Predictor App</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.12.1/plotly.min.js"></script>
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles.css') }}">
    
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>

<body>
    <!-- <a href="{{ url_for('FuturePrediction') }}">FuturePrediction</a> -->
    <div class="root">
        <nav class="navbar">
            <div class="screenshot-container">
                <img class="screenshot-2024-08-03-232051-1" loading="lazy" alt="" src="{{url_for('static', filename='logo.png')}}">
                <div class="sharemarket-wrapper">BullBearHub</div>
            </div>
            <form method="post" class="form-inline">
                <div class="form-group">
                    <label class="search-stock" for="stockInput">Search Stock:</label>
                    <div class="dropdown">
                        <input type="text" class="form-control" id="stockInput" name="stock" autocomplete="off">
                        <div id="suggestions" class="dropdown-menu"></div>
                    </div>
                    <button type="submit" class="btn btn-primary">Get Stock Data</button>
                </div>
            </form>
            <div class="wrapper">
                <div class="Sign-Out">...</div>
                <div class="dropdownSignout" id="dropdownMenu">
                  <a href="#">Profile</a>
                  <a href="#">Settings</a>
                  <button class="btn btn-outline-success" type="button" id="signoutbutton">Sign Out</button>
                </div>
              </div>
        </nav>
    </div>
<hr class="Line">
<div class="menu">
    <ul class="menu-list">
        <a href="#Stock"><li>Protfolio</li></a>
        <a href="#Livechart"><li>Chart</li></a>
        <a href="#StockMarketData"><li>Stock Market Data</li></a>
        <a href="#OriginalVSPredicted"><li>Original value VS Prediction value</li></a>
        <a href="{{ url_for('FuturePrediction') }}"><li>FuturePrediction</li></a>
    </ul>
  </div>

    <h3 id="Stock">Stock: {{ stock }}</h3>

    <h2>Latest Stock Market Data</h2>
    <div id="latestStockData" class="scrollable-table">Loading...</div>

    <h2>Additional Stock Metrics</h2>
    <div id="additionalStockData" class="scrollable-table">Loading...</div>

    <h2 id="StockMarketData">Stock Data</h2>
    <div class="scrollable-table">{{ tables[0] | safe }}</div>

    <h2>Latest Closing Price: {{ latest_close }}</h2>
    
    <div id="Livechart">{{ live_tracking_plot|safe }}</div>
    
<div class="Main-Container">
    <div class="container">
        <div class="zoomable" id="zoomableDiv">
    <div  class="chart">{{ ma_250_plot | safe }}</div>
</div>
<button class="close-btn" id="closeBtn">✖</button>
</div>
<div class="container">
    <div class="zoomable" id="zoomableDiv">
    <div  class="chart">{{ ma_200_plot | safe }}</div>
</div>
<button class="close-btn" id="closeBtn">✖</button>
</div>
</div>
<div class="Main-Container">
<div class="container">
    <div class="zoomable" id="zoomableDiv">
    <div class="chart">{{ ma_100_plot | safe }}</div>
</div>
<button class="close-btn" id="closeBtn">✖</button>
</div>


<div class="container">
    <div class="zoomable" id="zoomableDiv">   
    <div class="chart">{{ ma_100_250_plot | safe }}</div>
</div>
<button class="close-btn" id="closeBtn">✖</button>
</div>
</div>

    <div id="OriginalVSPredicted" class="chart">{{ close_price_plot | safe }}</div>



    <div class="scrollable-table">{{ plotting_data | safe }}</div>
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-heading">
                <img class="screenshot-2024-08-03-232051-1" loading="lazy" alt="" src="{{url_for('static', filename='logo.png')}}">
                <h1>BullBearHub</h1>
            </div>
            <div class="footer-columns">
                <div class="footer-column">
                    <h2>About Us</h2>
                    <ul>
                        <li><a href="#company">Company</a></li>
                        <li><a href="#team">Team</a></li>
                        <li><a href="#careers">Careers</a></li>
                        <li><a href="#careers">Features</a></li>
                        <li><a href="#careers">Partners</a></li>
                        <li><a href="#careers">Security</a></li>
                        <li><a href="#careers">Roadmap</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h2>Services</h2>
                    <ul>
                        <li><a href="#pricing">Pricing</a></li>
                        <li><a href="#features">Features</a></li>
                        <li><a href="#reviews">Reviews</a></li>
                        <li><a href="#careers">Product</a></li>
                        <li><a href="#careers">Skill</a></li>
                        <li><a href="#careers">Careers</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h2>Support</h2>
                    <ul>
                        <li><a href="#faq">FAQ</a></li>
                        <li><a href="#contact">Contact Us</a></li>
                        <li><a href="#help">Help Center</a></li>
                        <li><a href="#careers">Security</a></li>
                        <li><a href="#careers">Docs</a></li>
                        <li><a href="#careers">Premium Support</a></li>
                        <li><a href="#careers">Status</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="footer-bottom" style="height: 10px;">
            <div class="footer-copy">
                
                <p>&copy; 2024 StockMarket. All rights reserved.</p>
                <a href="#" >Terms</a>
                <a href="#">Privacy (Updated 08/2024)</a>
                <a href="#">Manage cookies</a>
                <a href="#">Do not share my personal information</a>
            </div>
            <div class="footer-social">
                <i class="fa-brands fa-x-twitter"></i>
                <i class="fa-brands fa-facebook"></i>
                <i class="fa-brands fa-linkedin"></i>
                <i class="fa-brands fa-instagram"></i>
                <i class="fa-brands fa-youtube"></i>
            </div>
        </div>
    </footer>
    
    
   
    <!-- <script>document.addEventListener("DOMContentLoaded", function() {
        const zoomableDivs = document.querySelectorAll(".zoomable");
        const closeBtns = document.querySelectorAll(".close-btn");
    
        zoomableDivs.forEach((div, index) => {
            div.addEventListener("click", function() {
                div.classList.add("zoomed");
            });
        });
    
        closeBtns.forEach((btn, index) => {
            btn.addEventListener("click", function() {
                zoomableDivs[index].classList.remove("zoomed");
            });
        });
    });
    
    </script> -->
    <script>
        document.querySelector('.Sign-Out').addEventListener('click', function() {
          var dropdown = document.getElementById('dropdownMenu');
          if (dropdown.style.display === 'block') {
            dropdown.style.display = 'none';
          } else {
            dropdown.style.display = 'block';
          }
        });
    
        // Optional: Close the dropdown if clicking outside of it
        window.onclick = function(event) {
          if (!event.target.matches('.Sign-Out')) {
            var dropdown = document.getElementById('dropdownMenu');
            if (dropdown.style.display === 'block') {
              dropdown.style.display = 'none';
            }
          }
        }
      </script>

    <script>
        $(document).ready(function() {
            $('#stockInput').on('input', function() {
                var query = $(this).val();
                if (query.length > 2) {
                    $.ajax({
                        url: '/search_suggestions',
                        type: 'GET',
                        data: { query: query },
                        success: function(data) {
                            var suggestions = $('#suggestions');
                            suggestions.empty();
                            if (data.length) {
                                data.forEach(function(item) {
                                    var suggestionHTML = `
                                        <a class="dropdown-item" data-stock-id="${item.StockID}" 
                                           data-name="${item.Name}" data-country="${item.Country}" 
                                           data-category="${item['Category Name']}">
                                           ${item.Name} (${item.StockID}) - ${item.Country} - ${item['Category Name']}
                                        </a>`;
                                    suggestions.append(suggestionHTML);
                                });
                                suggestions.show();
                            } else {
                                suggestions.append('<a class="dropdown-item disabled">No suggestions</a>');
                                suggestions.show();
                            }
                        },
                        error: function() {
                            $('#suggestions').empty().append('<a class="dropdown-item disabled">Error fetching suggestions</a>').show();
                        }
                    });
                } else {
                    $('#suggestions').hide();
                }
            });

            $(document).on('click', '.dropdown-item', function() {
                var stockID = $(this).data('stock-id');
                $('#stockInput').val(stockID); // Set the StockID in the input field
                $('#suggestions').hide(); // Hide the suggestions dropdown
                fetchLatestStockData(stockID); // Fetch latest stock data for selected stock
            });

            $(document).click(function(event) {
                if (!$(event.target).closest('.dropdown').length) {
                    $('#suggestions').hide();
                }
            });

            function fetchLatestStockData(stock) {
                $.ajax({
                    url: '/latest_stock_data',
                    type: 'GET',
                    data: { stock: stock },
                    success: function(response) {
                        $('#latestStockData').html(response.latest_data);
                        $('#additionalStockData').html(response.additional_data);
                    },
                    error: function() {
                        $('#latestStockData').html('<p>Error fetching latest data.</p>');
                        $('#additionalStockData').html('<p>Error fetching additional data.</p>');
                    }
                });
            }

            // Fetch latest stock data when the page loads
            fetchLatestStockData('{{ stock }}');
        });
    </script>
   
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
    <script>
        let UserCreds = JSON.parse(sessionStorage.getItem("user-creds"));
        let UserInfo = JSON.parse(sessionStorage.getItem("user-info"));

        let MsgHead = document.getElementById('msg');
        let GreetHead = document.getElementById('greet');
        let SignoutBtn = document.getElementById('signoutbutton');



        let Signout = () => {
            sessionStorage.removeItem("user-creds");
            sessionStorage.removeItem("user-info");
            window.location.href = "{{ url_for('main1') }}"
        }

        let CheckCred = () => {
            if (!sessionStorage.getItem("user-creds"))
                window.location.href = "{{ url_for('main1') }}"
            else {
                MsgHead.innerText = `user with email "${UserCreds.email}" logged in`;
                GreetHead.innerText = `welcome ${UserInfo.firstname + " " + UserInfo.lastname}!`;
            }
        }
        window.addEventListener('load', CheckCred);
        SignoutBtn.addEventListener('click', Signout);



    </script>
</body>

</html>
